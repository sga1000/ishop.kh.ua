<?xml version="1.0" encoding="UTF-8"?>
<modification>
	<name>NeoSeo Layout Cache</name>
	<version>1.0</version>
	<code>neoseo_layout_cache</code>
	<author>NeoSeo</author>
	<link>http://neoseo.com.ua/</link>

	<file path="system/library/document.php">
		<operation>
			<search><![CDATA[public function setTitle]]></search>
			<add position="before">
				<![CDATA[
		/* NeoSeo Layout Cache begin */
	public function startCollectDataForCache()
	{
		$this->collecting = true;
		$this->collected_data = array();
	}

	public function stopCollectAndSave()
	{
		$this->collecting = false;
		return $this->collected_data;
	}

	public function restoreDataFromCache($restored_data)
	{
		if(is_array($restored_data)){
			if(isset($restored_data['scripts'])){
				foreach ($restored_data['scripts'] as $script){
					$this->scripts[$script['position']][$script['href']] = $script['href'];
				}
			}
			if(isset($restored_data['styles'])){
				foreach ($restored_data['styles'] as $style){
					$this->styles[$style['href']] = array(
						'href'  => $style['href'],
						'rel'   => $style['rel'],
						'media' => $style['media'],
					);
				}
			}
			if(isset($restored_data['link'])){
				foreach ($restored_data['link'] as $link){
					$this->links[$link['href']] = array(
						'href' => $link['href'],
						'rel'  => $link['rel'],
					);
				}
			}
		}
	}
		/* NeoSeo Layout Cache end */
]]>
			</add>
		</operation>
		<operation>
			<search><![CDATA[private $title;]]></search>
			<add position="after">
				<![CDATA[
	/* NeoSeo Layout Cache begin */
	private $collecting = false;
	private $collected_data = array();
	/* NeoSeo Layout Cache end */]]>
			</add>
		</operation>
		<operation>
			<search><![CDATA[public function addLink]]></search>
			<add position="after">
				<![CDATA[
	/* NeoSeo Layout Cache begin */
		if($this->collecting){
			$this->collected_data['link'][$href] = array(
				'href' => $href,
				'rel'  => $rel
			);
		}
	/* NeoSeo Layout Cache end */]]>
			</add>
		</operation>
		<operation>
			<search><![CDATA[public function addStyle]]></search>
			<add position="after">
				<![CDATA[
	/* NeoSeo Layout Cache begin */
		if($this->collecting){
			$this->collected_data['styles'][$href] = array(
				'href'  => $href,
				'rel'   => $rel,
				'media' => $media
			);
		}
	/* NeoSeo Layout Cache end */]]>
			</add>
		</operation>
		<operation>
			<search><![CDATA[public function addScript]]></search>
			<add position="after">
				<![CDATA[
	/* NeoSeo Layout Cache begin */
		if($this->collecting){
			$this->collected_data['scripts'][] = ['position' => $postion,'href' => $href];
		}
	/* NeoSeo Layout Cache end */]]>
			</add>
		</operation>
	</file>

	<file path="catalog/controller/common/column_left.php">
		<operation>
			<search><![CDATA[$modules = $this->model_design_layout->getLayoutModules($layout_id, 'column_left');]]></search>
			<add position="before">
				<![CDATA[
	/* NeoSeo Layout Cache begin */
		$this->load->model('tool/neoseo_optimizer_cacher');
		$data['modules'] = $this->model_tool_neoseo_optimizer_cacher->processBlocks($layout_id,'column_left');
	/* Comment for history BEGIN
	// NeoSeo Layout Cache end ]]>
			</add>
		</operation>
		<operation>
			<search><![CDATA[if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') . '/template/common/column_left.tpl'))]]></search>
			<add position="before">
				<![CDATA[
	// NeoSeo Layout Cache begin
	 */ // comment for history END
	// NeoSeo Layout Cache end ]]>
			</add>
		</operation>
		//
	</file>

	<file path="catalog/controller/common/column_right.php">
		<operation>
			<search><![CDATA[$modules = $this->model_design_layout->getLayoutModules($layout_id, 'column_right');]]></search>
			<add position="before">
				<![CDATA[
	/* NeoSeo Layout Cache begin */
		$this->load->model('tool/neoseo_optimizer_cacher');
		$data['modules'] = $this->model_tool_neoseo_optimizer_cacher->processBlocks($layout_id,'column_right');
		/* Comment for history BEGIN
	// NeoSeo Layout Cache end ]]>
			</add>
		</operation>
		<operation>
			<search><![CDATA[if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') . '/template/common/column_right.tpl'))]]></search>
			<add position="before">
				<![CDATA[
	// NeoSeo Layout Cache begin
	 */ // comment for history END
	// NeoSeo Layout Cache end ]]>
			</add>
		</operation>
		//
	</file>

	<file path="catalog/controller/common/content_bottom.php">
		<operation>
			<search><![CDATA[$modules = $this->model_design_layout->getLayoutModules($layout_id, 'content_bottom');]]></search>
			<add position="before">
				<![CDATA[
	/* NeoSeo Layout Cache begin */
		$this->load->model('tool/neoseo_optimizer_cacher');
		$data['modules'] = $this->model_tool_neoseo_optimizer_cacher->processBlocks($layout_id,'content_bottom');
		/* Comment for history BEGIN
	// NeoSeo Layout Cache end ]]>
			</add>
		</operation>
		<operation>
			<search><![CDATA[if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') . '/template/common/content_bottom.tpl'))]]></search>
			<add position="before">
				<![CDATA[
	// NeoSeo Layout Cache begin
	 */ // comment for history END
	// NeoSeo Layout Cache end ]]>
			</add>
		</operation>
		//
	</file>

	<file path="catalog/controller/common/content_top.php">
		<operation>
			<search><![CDATA[$modules = $this->model_design_layout->getLayoutModules($layout_id, 'content_top');]]></search>
			<add position="before">
				<![CDATA[
	/* NeoSeo Layout Cache begin */
		$this->load->model('tool/neoseo_optimizer_cacher');
		$data['modules'] = $this->model_tool_neoseo_optimizer_cacher->processBlocks($layout_id,'content_top');
		/* Comment for history BEGIN
	// NeoSeo Layout Cache end ]]>
			</add>
		</operation>
		<operation>
			<search><![CDATA[if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') . '/template/common/content_top.tpl'))]]></search>
			<add position="before">
				<![CDATA[
	// NeoSeo Layout Cache begin
	 */ // comment for history END
	// NeoSeo Layout Cache end ]]>
			</add>
		</operation>
		//
	</file>
</modification>