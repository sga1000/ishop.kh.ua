<?xml version="1.0" encoding="UTF-8"?>
<modification>
    <name>NeoSeo Display More</name>
    <version>1.0.1.3</version>
    <code>neoseo_display_more</code>
    <author>NeoSeo</author>
    <link>http://neoseo.com.ua/neoseo-displaymore</link>

    <file path="catalog/controller/product/{search,category,special}.php">
        <operation>
            <search><![CDATA[public function index() {]]></search>
            <add position="before"><![CDATA[	/* NeoSeo Display More BEGIN */
	private function isAjax() {
		if(isset($_SERVER['HTTP_X_REQUESTED_WITH']) && !empty($_SERVER['HTTP_X_REQUESTED_WITH']) && strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest')  {
			return true;
		} else {
			return false;
		}
	}
	/* NeoSeo Display More END */]]></add>
        </operation>
        <operation>
            <search><![CDATA[
    $data['limit'] = $limit;
    ]]></search>
            <add position="after"><![CDATA[
            /* NeoSeo Display More BEGIN */
            if(!isset($this->request->get['page'])){
				$data['page_pagination'] = 1;
			}else{
				$data['page_pagination'] = $this->request->get['page'];
			}
			$neoseo_display_more_status = false;
			$data['status_more_btn_enable'] = false;
			$data['status_pagination'] = false;

			if ($this->config->get('neoseo_display_more_status')) {
				$neoseo_display_more_status = true;
			}

			if ($neoseo_display_more_status && $this->config->get('neoseo_display_more_status_more_btn_enable')) {
				$data['button_show_more'] = $this->language->get('button_show_more');
				$data['status_more_btn_enable'] = true;
			}
			if ($neoseo_display_more_status && $this->config->get('neoseo_display_more_status_pagination')) {
				$data['status_pagination'] = true;
			}
			$data['isAjax'] = $this->isAjax();
			/* NeoSeo Display More END */
	]]></add>
        </operation>
        <operation>
            <search><![CDATA[
    $data['column_left'] = $this->load->controller('common/column_left');
    ]]></search>
            <add position="before"><![CDATA[
			/* NeoSeo Display More BEGIN */
			if(!$this->isAjax())  {
			/* NeoSeo Display More END */
	]]></add>
        </operation>
        <operation>
            <search><![CDATA[
    $data['header'] = $this->load->controller('common/header');
    ]]></search>
            <add position="after"><![CDATA[
			/* NeoSeo Display More BEGIN */
			} else {
				$data['column_left'] = '';
				$data['column_right'] = '';
				$data['content_top'] = '';
				$data['content_bottom'] = '';
				$data['footer'] = '';
				$data['header'] = '';
			}
			/* NeoSeo Display More END */
	]]></add>
        </operation>
    </file>

    <file path="catalog/controller/product/manufacturer.php">
        <operation>
            <search><![CDATA[
        public function index() {
    ]]></search>
            <add position="before"><![CDATA[
            /* NeoSeo Display More BEGIN */
			private function isAjax() {
				if(isset($_SERVER['HTTP_X_REQUESTED_WITH']) && !empty($_SERVER['HTTP_X_REQUESTED_WITH']) && strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest')  {
					return true;
				} else {
					return false;
				}
			}
			/* NeoSeo Display More END */
    ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
    $data['limit'] = $limit;
    ]]></search>
            <add position="after"><![CDATA[
            /* NeoSeo Display More BEGIN */
            if(!isset($this->request->get['page'])){
				$data['page_pagination'] = 1;
			}else{
				$data['page_pagination'] = $this->request->get['page'];
			}
			$neoseo_display_more_status = false;
			$data['status_more_btn_enable'] = false;
			$data['status_pagination'] = false;

			if ($this->config->get('neoseo_display_more_status')) {
				$neoseo_display_more_status = true;
			}

			if ($neoseo_display_more_status && $this->config->get('neoseo_display_more_status_more_btn_enable')) {
				$data['button_show_more'] = $this->language->get('button_show_more');
				$data['status_more_btn_enable'] = true;
			}
			if ($neoseo_display_more_status && $this->config->get('neoseo_display_more_status_pagination')) {
				$data['status_pagination'] = true;
			}
			$data['isAjax'] = $this->isAjax();
			/* NeoSeo Display More END */
	]]></add>
        </operation>
        <operation>
            <search><![CDATA[
    $data['column_left'] = $this->load->controller('common/column_left');
    ]]></search>
            <add position="before"><![CDATA[
			/* NeoSeo Display More BEGIN */
			if(!$this->isAjax())  {
			/* NeoSeo Display More END */
	]]></add>
        </operation>
        <operation>
            <search><![CDATA[
    $data['content_bottom'] = $this->load->controller('common/content_bottom');
    ]]></search>
            <add position="after"><![CDATA[
			/* NeoSeo Display More BEGIN */
			} else {
				$data['column_left'] = '';
				$data['column_right'] = '';
				$data['content_top'] = '';
				$data['content_bottom'] = '';
				$data['footer'] = '';
				$data['header'] = '';
			}
			/* NeoSeo Display More END */
	]]></add>
        </operation>
    </file>

    <file path="catalog/language/russian/russian.php">
        <operation>
            <search><![CDATA[
    $_['button_address_add']
    ]]></search>
            <add position="before"><![CDATA[
    /* NeoSeo Display More BEGIN */
    $_['button_show_more']      = 'Показать ещё';
    /* NeoSeo Display More END */
    ]]></add>
        </operation>
    </file>
    <file path="catalog/language/english/english.php">
        <operation>
            <search><![CDATA[
    $_['button_address_add']
    ]]></search>
            <add position="before"><![CDATA[
    /* NeoSeo Display More BEGIN */
    $_['button_show_more']      = 'Show more';
    /* NeoSeo Display More END */
    ]]></add>
        </operation>
    </file>
    <file path="catalog/language/ukrainian/ukrainian.php">
        <operation>
            <search><![CDATA[
    $_['button_address_add']
    ]]></search>
            <add position="before"><![CDATA[
    /* NeoSeo Display More BEGIN */
    $_['button_show_more']      = 'Показати ще';
    /* NeoSeo Display More END */
    ]]></add>
        </operation>
    </file>
    <file path="catalog/view/theme/*/template/product/{search*,category*,manufacturer_info*,special*}.tpl">
        <operation>
            <search offset="2"><![CDATA[
    <?php echo $pagination; ?>
    ]]></search>
            <add position="before"><![CDATA[
            <!-- NeoSeo Display More BEGIN -->
            <?php if ($status_more_btn_enable) { ?>
            <div class="row">
                <div class="text-center">
                    <button type="button" id="button_show_more" onclick="showMore(this);" class="btn btn-primary" style="margin-bottom: 25px;"><?php echo $button_show_more; ?></button>
                </div>
            </div>

            <script type="text/javascript">
                document.addEventListener("DOMContentLoaded", function(){
                    if (!$('.pagination').length) {
                        $('#button_show_more').hide();
                    } else {
                        <?php if ($status_pagination) { ?>
                        $('.pagination').css('display', 'none');
                        <?php } ?>
                    }
                	let next = $('.pagination li.active').next('li').find('a');
                    if (next.length == 0) {
						$('#button_show_more').hide();
						return;
					}
                });
                function showMore() {
                    let next = $('.pagination li.active').next('li').find('a');

                    if (next.length == 0) {
                    return;
                }

                $.get(next.attr('href'), function (data) {
                     $(data).filter('script').each(function () {
                        if ((this.text || this.textContent || this.innerHTML).indexOf("document.write") >= 0) {
                            return;
                        }
                        $.globalEval(this.text || this.textContent || this.innerHTML || '');
                    });


                    if ($('.product-layout').length) {
                        $('html, body').animate({scrollTop: $('.product-layout').eq(-1).offset().top}, 500);
                        let products = $(data).find('.product-layout').parent().html();

                        $('.product-layout:last-child').after(products);
                    }

                    if ($('.product-preview__layout').length) {
                        $('html, body').animate({scrollTop: $('.product-preview__layout').eq(-1).offset().top}, 500);
                        let products = $(data).find('.product-preview__layout').parent().html();

                        $('.product-preview__layout:last-child').after(products);
                    }

                    $('.pagination').html($(data).find('.pagination > *'));
                    $('.pagination').parent().next('.text-right').html($(data).find('.pagination').parent().next('.text-right').html());
                    if ($('.pagination li.active').next('li').length == 0) {
                        $('#button_show_more').hide();
                    }
                    var page = parseInt($('.pagination li.active').find('span').html());
                    $('.pagination > li').each(function (){

                        var page2 = parseInt($(this).find('a').html());

                        if(page2 != undefined  && page != undefined ){
                            if(page2 >= <?php echo $page_pagination; ?> && page > page2 ){
                                $(this).html('<span class="box-shadow">'+page2+'</span>');
                                $(this).addClass('active');
                            }
                        }
                    });

                    if (localStorage.getItem('display') == 'list') {
                        $('#list-view').trigger('click');
                        $('#list-view').addClass('active');
                    } else if(localStorage.getItem('display') == 'table') {
                        $('#table-view').trigger('click');
                        $('#table-view').addClass('active');
                    } else {
                        $('#grid-view').trigger('click');
                        $('#grid-view').addClass('active');
                    }
                }, "html");
                return false;
            }
        </script>
      <?php } ?>
      <!-- NeoSeo Display More END -->
    ]]></add>
        </operation>
    </file>



</modification>