<?xml version="1.0" encoding="UTF-8"?>
<modification>
    <name>NeoSeo Product Archive</name>
    <version>1.0</version>
    <code>neoseo-product-archive</code>
    <author>NeoSeo</author>

     <file path="admin/controller/catalog/category.php">
        <operation>
            <search><![CDATA[$data['text_disabled'] = $this->language->get('text_disabled');]]></search>
            <add position="after"><![CDATA[                /* NeoSeo Product Archive - begin */
		$this->language->load('catalog/neoseo_product_archive');
		$data['text_archive'] = $this->language->get('text_archive');
		$data['text_product_similar_category'] = $this->language->get('text_product_similar_category');
		/* NeoSeo Product Archive  - end */]]></add>
        </operation>
        <operation>
            <search><![CDATA[$this->load->model('design/layout');]]></search>
            <add position="before"><![CDATA[
		/* NeoSeo Product Archive - begin */
		$data['status_archive_product'] = $this->config->get('neoseo_product_archive_status');
		if(isset($this->request->get['category_id'])){
			$category_id = (int)$this->request->get['category_id'];
		} else {
			$category_id = 0;
		}
		$data['categories'] = $this->model_catalog_category->getAllCategoriesWithoutRequested($category_id);
		/* NeoSeo Product Archive  - end */]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[if (isset($this->request->post['status'])) {]]></search>
            <add position="before"><![CDATA[
		/* NeoSeo Product Archive - begin */
		if (isset($this->request->post['product_similar_category'])) {
			$data['product_similar_category'] = $this->request->post['product_similar_category'];
		} elseif (!empty($category_info)) {
			$data['product_similar_category'] = $category_info['product_similar_category'];
		} else {
		    $data['product_similar_category'] = '';
		}
		/* NeoSeo Product Archive  - end */
                ]]></add>
        </operation>
    </file>


    <file path="admin/model/catalog/category.php">
        <operation>
            <search><![CDATA[public function addCategory(]]></search>
            <add position="after"><![CDATA[
		/* NeoSeo Product Archive - begin */
		$status_archive_product = $this->config->get('neoseo_product_archive_status');
		$add='';
		if($status_archive_product){
			$add=" ,`product_similar_category` = '".$this->db->escape($data['product_similar_category'] )."'";
		}
		/* NeoSeo Product Archive  - end */]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[date_added = NOW()"]]></search>
            <add position="replace"><![CDATA[date_added = NOW()".$add.""]]></add>
        </operation>
        <operation>
            <search><![CDATA[public function editCategory(]]></search>
            <add position="after"><![CDATA[
		/* NeoSeo Product Archive - begin */
		$status_archive_product = $this->config->get('neoseo_product_archive_status');
		$update='';
		if($status_archive_product){
			$update=" ,product_similar_category = '".$this->db->escape($data['product_similar_category'] )."'";
		}
		/* NeoSeo Product Archive  - end */]]></add>
        </operation>
        <operation>
           <search index="1"><![CDATA[date_modified = NOW()]]></search>
             <add position="replace"><![CDATA[date_modified = NOW() ".$update."]]></add>
        </operation>
        <operation>
            <search><![CDATA[public function getCategoryDescriptions(]]></search>
            <add position="before"><![CDATA[
	/* NeoSeo Product Archive - begin */
	public function getAllCategoriesWithoutRequested($category_id) {
		$sql = "
			SELECT cp.category_id AS category_id, GROUP_CONCAT(cd1.name ORDER BY cp.level SEPARATOR '&nbsp;&nbsp;&gt;&nbsp;&nbsp;') AS name, c1.parent_id, c1.sort_order FROM " . DB_PREFIX . "category_path cp
			LEFT JOIN " . DB_PREFIX . "category c1 ON (cp.category_id = c1.category_id)
			LEFT JOIN " . DB_PREFIX . "category c2 ON (cp.path_id = c2.category_id)
			LEFT JOIN " . DB_PREFIX . "category_description cd1 ON (cp.path_id = cd1.category_id)
			LEFT JOIN " . DB_PREFIX . "category_description cd2 ON (cp.category_id = cd2.category_id)
			WHERE
				cd1.language_id = '" . (int)$this->config->get('config_language_id') . "'
				AND cd2.language_id = '" . (int)$this->config->get('config_language_id') . "'
				AND cp.category_id != $category_id
			GROUP BY
				cp.category_id";
		$query = $this->db->query($sql);
		foreach ($query->rows as $result) {
			$data['categories'][] = array(
				'category_id' => $result['category_id'],
				'name'        => $result['name']
				);
		}
		return $data['categories'];
	}
	/* NeoSeo Product Archive  - end */

	]]></add>
	</operation>
    </file>

    <file path="admin/view/template/catalog/category_form.tpl">
        <operation>
            <search><![CDATA[<?php if ($status) { ?>]]></search>
            <add position="after"><![CDATA[                    <!-- NeoSeo Product Archive - begin -->
                    <?php if ($status==1) { ?>
                    <!-- NeoSeo Product Archive  - end -->]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[<option value="1" selected="selected"><?php echo $text_enabled; ?></option>]]></search>
            <add position="after"><![CDATA[
                    <!-- NeoSeo Product Archive - begin -->
                    <?php if ($status_archive_product) { ?>
                    <option value="2"><?php echo $text_archive; ?></option>
                    <?php } ?>
                    <?php } ?>
                    <?php if ((int)$status==2) { ?>
                    <option value="1"><?php echo $text_enabled; ?></option>
                    <?php if ($status_archive_product) { ?>
                    <option value="2"  selected="selected"><?php echo $text_archive; ?></option>
                    <?php } ?>
                    <?php } ?>
                    <!-- NeoSeo Product Archive  - end -->]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[<option value="0" selected="selected"><?php echo $text_disabled; ?></option>]]></search>
            <add position="after"><![CDATA[                    <!-- NeoSeo Product Archive - begin -->
                    <option value="2"><?php echo $text_archive; ?></option>
                      <!-- NeoSeo Product Archive  - end -->]]></add>
        </operation>
        <operation>
            <search><![CDATA[<label class="col-sm-2 control-label" for="input-status"><?php echo $entry_status; ?></label>]]></search>
            <add position="before"><![CDATA[                <!-- NeoSeo Product Archive - begin -->
                <?php if ($status_archive_product) { ?>
                <label class="col-sm-2 control-label"><?php echo $text_product_similar_category; ?></label>
                <div class="col-sm-10">
                  <select name="product_similar_category" class="form-control">
                    <option value="0" selected="selected"><?php echo $text_none; ?></option>
                    <?php foreach ($categories as $category) { ?>
                    <?php if ($category['category_id'] == $product_similar_category) { ?>
                    <option value="<?php echo $category['category_id']; ?>" selected="selected"><?php echo $category['name']; ?></option>
                    <?php } else { ?>
                    <option value="<?php echo $category['category_id']; ?>"><?php echo $category['name']; ?></option>
                    <?php } ?>
                    <?php } ?>
                  </select>
                </div>
          </div>
        <div class="form-group">
        <?php } ?>
                <!-- NeoSeo Product Archive  - end -->]]></add>
        </operation>
    </file>

    <file path="catalog/controller/product/category.php">
        <operation>
            <search><![CDATA[$data['sort'] = $sort;]]></search>
            <add position="before"><![CDATA[
			/* NeoSeo Product Archive - begin */
			$status_product_archive=$this->config->get('neoseo_product_archive_status');
			if($status_product_archive && $category_info['status']==2){
				$location_url = $this->url->link('product/category', 'path=' . $category_info['product_similar_category'], 'SSL');
				header('Location: ' . html_entity_decode(($location_url)), true, 301);
			}
			/* NeoSeo Product Archive  - end */]]></add>
        </operation>
    </file>

    <file path="catalog/model/catalog/category.php">
            <operation>
            <search index='0'><![CDATA[c.status = '1']]></search>
            <add position="replace"><![CDATA[".$where."]]></add>
        </operation>
        <operation>
            <search><![CDATA[public function getCategory($category_id) {]]></search>
            <add position="after"><![CDATA[
		/* NeoSeo Product Archive - begin */
		$status_archive_product = $this->config->get('neoseo_product_archive_status');
		$where=" c.status = '1' ";
		if($status_archive_product){
			$where=' (c.status = "1" OR c.status = "2") ';
		}
		/* NeoSeo Product Archive  - end */]]></add>
        </operation>
    </file>

    <file path="admin/controller/catalog/product.php">
        <operation>
            <search><![CDATA[$data['text_disabled'] = $this->language->get('text_disabled');]]></search>
            <add position="after"><![CDATA[
		/* NeoSeo Product Archive - begin */
		$this->language->load('catalog/neoseo_product_archive');
		$data['entry_product_similar_category'] = $this->language->get('entry_product_similar_category');
		$data['entry_product_similar_product'] = $this->language->get('entry_product_similar_product');
		/* NeoSeo Product Archive  - end */]]></add>
        </operation>
        <operation>
            <search><![CDATA[if (isset($this->request->post['product_related'])) {]]></search>
            <add position="before"><![CDATA[
		/* NeoSeo Product Archive - begin */
		$status_product_archive=$this->config->get('neoseo_product_archive_status');
		$data['product_archive'] = false;

		$data['product_similar_category']=array();
		$data['product_similar_product'] = array();

		if($status_product_archive && isset($this->request->get['product_id']) && count($this->config->get('neoseo_product_archive_stock_statuses'))>0 ){
			$product_similar_category = $this->model_catalog_product->getProductSimilarCategory($this->request->get['product_id']);
			$product_similar_product = $this->model_catalog_product->getProductSimilarProduct($this->request->get['product_id']);
			if(count($product_similar_category)>0){
				foreach ($product_similar_category as $category_id) {
					$similar_category_info = $this->model_catalog_category->getCategory($category_id);
					if ($similar_category_info) {
						$similar_category_info['href']=$this->url->link('product/category', $url . '&path=' . $category_id);
						$data['product_similar_category'][$category_id] = $similar_category_info;
					}
				}
			}

			if(count($product_similar_product)>0){
				foreach ($product_similar_product as $product_id) {
					$similar_product_info = $this->model_catalog_product->getProduct($product_id);
					if ($similar_product_info) {
						$similar_product_info['href']=$this->url->link('product/product', $url . '&product_id=' . $product_id);
						$data['product_similar_product'][$product_id] = $similar_product_info;
					}
				}
			}

			$data['product_archive'] = true;
			$data['text_similar_category']=$this->language->get('text_similar_category');
			$data['text_similar_product']=$this->language->get('text_similar_product');
		    }
		    /* NeoSeo Product Archive  - end */
                   ]]></add>
        </operation>
        <operation>
            <search><![CDATA[$this->model_catalog_product->editProduct($this->request->get['product_id'], $this->request->post);]]></search>
            <add position="after"><![CDATA[
			/* NeoSeo Product Archive - begin */
			$this->load->model('tool/neoseo_product_archive');
			$product_similar_category = isset($this->request->post['product_similar_category']) ? $this->request->post['product_similar_category'] : array();
			$this->model_tool_neoseo_product_archive->updateProductSimilarCategory($product_similar_category,$this->request->get['product_id']);
			unset($this->request->post['product_similar_category']);

			$product_similar_product = isset($this->request->post['product_similar_product']) ? $this->request->post['product_similar_product'] : array();
			$this->model_tool_neoseo_product_archive->updateProductSimilarProduct($product_similar_product,$this->request->get['product_id']);
			unset($this->request->post['product_similar_product']);
			/* NeoSeo Product Archive  - end */]]></add>
        </operation>
        <operation>
            <search><![CDATA[$this->model_catalog_product->addProduct($this->request->post);]]></search>
            <add position="replace"><![CDATA[
			/* NeoSeo Product Archive - begin */
			$last_produst_id=$this->model_catalog_product->addProduct($this->request->post);
			$this->load->model('tool/neoseo_product_archive');
			if(isset($this->request->post['product_similar_category'])){
				$this->model_tool_neoseo_product_archive->updateProductSimilarCategory($this->request->post['product_similar_category'],$last_produst_id);
				unset($this->request->post['product_similar_category']);
			}
			if(isset($this->request->post['product_similar_product'])){
				$this->model_tool_neoseo_product_archive->updateProductSimilarProduct($this->request->post['product_similar_product'],$last_produst_id);
				unset($this->request->post['product_similar_product']);
			}
			/* NeoSeo Product Archive  - end */]]></add>
        </operation>
    </file>

    <file path="admin/model/catalog/product.php">
        <operation>
            <search><![CDATA[public function getProductRelated($product_id) {]]></search>
            <add position="before"><![CDATA[
	/* NeoSeo Product Archive - begin */
	public function getProductSimilarProduct($product_id) {
		$product_similar_product = array();

		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_similar_product WHERE product_id = '" . (int)$product_id . "'");

		foreach ($query->rows as $result) {
			$product_similar_product[] = $result['similar_product_id'];
		}

		return $product_similar_product;
	}

	public function getProductSimilarCategory($product_id) {
		$product_similar_category = array();

		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_similar_category WHERE product_id = '" . (int)$product_id . "'");

		foreach ($query->rows as $result) {
			$product_similar_category[] = $result['similar_category_id'];
		}

		return $product_similar_category;
	}
	/* NeoSeo Product Archive  - end */
        ]]></add>
        </operation>
    </file>

    <file path="admin/view/template/catalog/product_form.tpl">
        <operation>
            <search><![CDATA[<label class="col-sm-2 control-label" for="input-related"><span data-toggle="tooltip" title="<?php echo $help_related; ?>"><?php echo $entry_related; ?></span></label>]]></search>
            <add position="before"><![CDATA[                <!-- NeoSeo Product Archive - begin-->
                <?php if(isset($product_archive) && $product_archive) { ?>
                <label class="col-sm-2 control-label" for="input-product_similar_product"><?php echo $entry_product_similar_product; ?></label>
                <div class="col-sm-10">
                  <input type="text" name="similar_product" value="" placeholder="<?php echo $entry_product_similar_product; ?>" id="input-product_similar_product" class="form-control" />
                  <div id="product_similar_product" class="well well-sm" style="height: 150px; overflow: auto;">
                    <?php foreach ($product_similar_product as $product_similar_prod) { ?>
                    <div id="similar_product<?php echo $product_similar_prod['product_id']; ?>"><i class="fa fa-minus-circle"></i> <?php echo $product_similar_prod['name']; ?>
                      <input type="hidden" name="product_similar_product[]" value="<?php echo $product_similar_prod['product_id']; ?>" />
                    </div>
                    <?php } ?>
                  </div>
                </div>
              </div>
               <div class="form-group">
                <label class="col-sm-2 control-label" for="input-product_similar_category"><?php echo $entry_product_similar_category; ?></label>
                <div class="col-sm-10">
                  <input type="text" name="similar_category" value="" placeholder="<?php echo $entry_product_similar_category; ?>" id="input-product_similar_category" class="form-control" />
                  <div id="product_similar_category" class="well well-sm" style="height: 150px; overflow: auto;">
                    <?php foreach ($product_similar_category as $product_similar_cat) { ?>
                    <div id="similar_category<?php echo $product_similar_cat['category_id']; ?>"><i class="fa fa-minus-circle"></i> <?php echo $product_similar_cat['name']; ?>
                      <input type="hidden" name="product_similar_category[]" value="<?php echo $product_similar_cat['category_id']; ?>" />
                    </div>
                    <?php } ?>
                  </div>
                </div>
              </div>
                <div class="form-group">
                <?php } ?>
                <!--  NeoSeo Product Archive  - end -->]]></add>
        </operation>
           <operation>
            <search><![CDATA[$('input[name=\'related\']').autocomplete({]]></search>
            <add position="before"><![CDATA[/* NeoSeo Product Archive - begin */
$('input[name=\'similar_product\']').autocomplete({
    'source': function(request, response) {
        $.ajax({
            url: 'index.php?route=catalog/product/autocomplete&token=<?php echo $token; ?>&filter_name=' +  encodeURIComponent(request),
            dataType: 'json',
            success: function(json) {
                response($.map(json, function(item) {
                    return {
                        label: item['name'],
                        value: item['product_id']
                    }
                }));
            }
        });
    },
    'select': function(item) {
        $('input[name=\'similar_product\']').val('');
        $('#product_similar_product' + item['value']).remove();
        $('#product_similar_product').append('<div id="product_similar_product' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="product_similar_product[]" value="' + item['value'] + '" /></div>');
    }
});

$('#product_similar_product').delegate('.fa-minus-circle', 'click', function() {
    $(this).parent().remove();
});
$('input[name=\'similar_category\']').autocomplete({
    'source': function(request, response) {
        $.ajax({
            url: 'index.php?route=catalog/category/autocomplete&token=<?php echo $token; ?>&filter_name=' +  encodeURIComponent(request),
            dataType: 'json',
            success: function(json) {
                response($.map(json, function(item) {
                    return {
                        label: item['name'],
                        value: item['category_id']
                    }
                }));
            }
        });
    },
    'select': function(item) {
        $('input[name=\'similar_category\']').val('');
        $('#product_similar_category' + item['value']).remove();
        $('#product_similar_category').append('<div id="product_similar_category' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="product_similar_category[]" value="' + item['value'] + '" /></div>');
    }
});

$('#product_similar_category').delegate('.fa-minus-circle', 'click', function() {
    $(this).parent().remove();
});
/* NeoSeo Product Archive  - end */]]></add>
        </operation>
    </file>

    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[$data['column_left']]]></search>
            <add position="before"><![CDATA[
			/* NeoSeo Product Archive - begin */
			$status_product_archive=$this->config->get('neoseo_product_archive_status');
			$data['product_archive'] = false;

			$data['product_similar_category']=array();
			$data['product_similar_product'] = array();

			if( $status_product_archive &&
				count($this->config->get('neoseo_product_archive_stock_statuses'))>0 &&
				in_array($product_info['stock_status_id'], $this->config->get('neoseo_product_archive_stock_statuses')) &&
				$product_info['quantity']<=0){
					$product_similar_category = $this->model_catalog_product->getProductSimilarCategory($this->request->get['product_id']);
					$product_similar_product = $this->model_catalog_product->getProductSimilarProduct($this->request->get['product_id']);
					if(count($product_similar_category)>0){
						foreach ($product_similar_category as $category_id) {
							$similar_category_info = $this->model_catalog_category->getCategory($category_id);
							if ($similar_category_info) {
								$similar_category_info['href'] = $this->url->link('product/category', $url . '&path=' . $category_id);
								$data['product_similar_category'][$category_id] = $similar_category_info;
							}
						}
					}
					if(count($product_similar_product)>0){
						foreach ($product_similar_product as $product_id) {
							$similar_product_info = $this->model_catalog_product->getProduct($product_id);
							if ($similar_product_info) {
								$width = $this->config->get('neoseo_product_archive_image_width');
								if(!$this->config->get('neoseo_product_archive_image_width')){
									$width='100';
								}
								$height = $this->config->get('neoseo_product_archive_image_height');
								if(!$this->config->get('neoseo_product_archive_image_height')){
									$height='100';
								}
								$similar_product_info['thumb']=$this->model_tool_image->resize($similar_product_info['image'],$width,$height);
								$similar_product_info['href']=$this->url->link('product/product', $url . '&product_id=' . $product_id);
								$data['product_similar_product'][$product_id] = $similar_product_info;
							}
						}
					}
					$this->language->load('module/neoseo_product_archive');
					$data['product_archive'] = true;
					$data['text_similar_category'] = $this->language->get('text_similar_category');
					$data['text_similar_product'] = $this->language->get('text_similar_product');
			}
			/* NeoSeo Product Archive  - end */]]></add>
        </operation>
        <operation>
            <search><![CDATA[$product_info = $this->model_catalog_product->getProduct($product_id);]]></search>
            <add position="replace"><![CDATA[
		/* NeoSeo Product Archive - begin */
		$product_info = $this->model_catalog_product->getProduct($product_id,true);
		/* NeoSeo Product Archive  - end */]]></add>
        </operation>
    </file>

    <file path="catalog/model/catalog/product.php">
        <operation>
            <search><![CDATA[public function getProduct($product_id) {]]></search>
            <add position="replace"><![CDATA[
	/* NeoSeo Product Archive - begin */
	public function getProductSimilarProduct($product_id) {
		$product_similar_product = array();
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_similar_product WHERE product_id = '" . (int)$product_id . "'");

		foreach ($query->rows as $result) {
			$product_similar_product[] = $result['similar_product_id'];
		}

		return $product_similar_product;
	}

	public function getProductSimilarCategory($product_id) {
		$product_similar_category = array();
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_similar_category WHERE product_id = '" . (int)$product_id . "'");

		foreach ($query->rows as $result) {
			$product_similar_category[] = $result['similar_category_id'];
		}

		return $product_similar_category;
	}

	public function getProduct($product_id, $get_archive=false) {
		$where=" p.status=1 ";
		if($get_archive){
			$archive_statuses = $this->config->get('neoseo_product_archive_stock_statuses');
			if(count($archive_statuses)>0){
				$where=" (p.status='1' OR p.stock_status_id IN (".implode(',',$archive_statuses).")) ";
			}
		}

	/* NeoSeo Product Archive  - end */]]></add>
        </operation>

	<operation>
            <search><![CDATA[if (!empty($data['filter_manufacturer_id'])) {]]></search>
            <add position="before"><![CDATA[		/* NeoSeo Product Archive - begin */
		if($this->config->get('neoseo_product_archive_stock_statuses')){ $sql .= ' AND (p.quantity>0 OR p.stock_status_id NOT IN (' . implode(',', $this->config->get('neoseo_product_archive_stock_statuses')) . ')) '; }
		/* NeoSeo Product Archive - end */]]>
			</add>
        </operation>

        <operation>
            <search><![CDATA['stock_status'     => $query->row['stock_status'],]]></search>
            <add position="after"><![CDATA[
				/* NeoSeo Product Archive - begin */
				'stock_status_id'  => $query->row['stock_status_id'],
				/* NeoSeo Product Archive  - end */]]></add>
        </operation>

        <operation>
			<search index="0"><![CDATA[WHERE p.product_id = '" . (int)$product_id . "' AND pd.language_id = '" . (int)$this->config->get('config_language_id') . "' AND p.status = '1']]></search>
			<add position="replace"><![CDATA[WHERE p.product_id = '" . (int)$product_id . "' AND pd.language_id = '" . (int)$this->config->get('config_language_id') . "' AND ".$where."]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/product/product.tpl">
        <operation>
            <search><![CDATA[<h1><?php echo $heading_title; ?></h1>]]></search>
            <add position="after"><![CDATA[      <!-- NeoSeo Product Archive - begin -->
          <?php if(isset($product_archive) && !$product_archive) { ?>
    <!-- NeoSeo Product Archive - end -->]]></add>
        </operation>
        <operation>
            <search><![CDATA[<?php if ($products) { ?>]]></search>
            <add position="before"><![CDATA[        <!-- NeoSeo Product Archive - begin -->
        <?php } else { ?>
        <?php if(isset($product_similar_category) && count($product_similar_category)>0){ ?>
                <p><?php echo $text_similar_category?></p>
                <?php foreach($product_similar_category as $category){ ?>
                        <p><a href="<?php echo $category['href']?>"><?php echo $category['name']?></a></p>
                <?php } ?>
        <?php } ?>
        <?php if(isset($product_similar_product) && count($product_similar_product)>0){ ?>
                <p><?php echo $text_similar_product?></p>
                <?php foreach($product_similar_product as $product){ ?>
                        <div class="image"><a href="<?php echo $product['href']; ?>"><img src="<?php echo $product['thumb']; ?>" alt="<?php echo $product['name']; ?>" title="<?php echo $product['name']; ?>" class="img-responsive" /></a></div>
                        <p><a href="<?php echo $product['href']?>"><?php echo $product['name']?></a></p>
                <?php } ?>
        <?php } ?>
        </div>
        </div>
        <?php }?>
        <!-- NeoSeo Product Archive - end -->]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/neoseo_unistor/template/product/product*.tpl">
        <operation>
            <search><![CDATA[<div class="product-list_bottom">]]></search>
            <add position="before"><![CDATA[
					<!-- NeoSeo Product Archive - begin -->
					<?php if(isset($product_archive) && !$product_archive) { ?>
					<!-- NeoSeo Product Archive - end -->]]></add>
        </operation>
        <operation>
            <search><![CDATA[<div class="product-list_manufacturer">]]></search>
            <add position="before"><![CDATA[
					<!-- NeoSeo Product Archive - begin -->
					<?php } ?>
					<!-- NeoSeo Product Archive - end -->]]></add>
        </operation>
        <operation>
            <search><![CDATA[<?php echo $text_all_characteristics; ?>]]></search>
            <add position="after" offset="2"><![CDATA[        <!-- NeoSeo Product Archive - begin -->
        <?php if (isset($product_similar_product) && count($product_similar_product)>0){ ?>
            <h3><?php echo $text_similar_product?></h3>
            <?php foreach($product_similar_product as $product){ ?>
                <div style="display: inline-block; width:100px; margin-right: 20px; vertical-align: top;" class="archive-aditionals">
                    <a href="<?php echo $product['href']; ?>" >
                        <img src="<?php echo $product['thumb']; ?>" alt="<?php echo $product['name']; ?>" title="<?php echo $product['name']; ?>" class=""/>
                        <?php echo $product['name']; ?>
                    </a>
                </div>
            <?php } ?>
        <?php } ?>

        <?php if(isset($product_similar_category) && count($product_similar_category)>0){ ?>
            <h3><?php echo $text_similar_category?></h3>
            <ul>
            <?php foreach($product_similar_category as $category){ ?>
                <li><a href="<?php echo $category['href']; ?>"><?php echo $category['name']; ?></a></li>
            <?php } ?>
            </ul>
        <?php } ?>
        <!-- NeoSeo Product Archive - end -->]]></add>
        </operation>
    </file>

</modification>